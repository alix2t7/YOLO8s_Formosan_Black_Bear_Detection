name: ðŸš€ Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    name: ðŸ“¦ å‰µå»º Release
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ðŸ è¨­ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ðŸ“¦ å®‰è£ä¾è³´
      run: |
        python -m pip install --upgrade pip
        pip install PyYAML
        
    - name: ðŸ§ª åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦
      run: |
        python test_basic_functionality.py
        
    - name: ðŸ“‹ ç”Ÿæˆ Release Notes
      id: release_notes
      run: |
        # æå–ç‰ˆæœ¬è™Ÿ
        VERSION=${GITHUB_REF#refs/tags/}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        
        # ç”Ÿæˆ Release Notes
        cat > release_notes.md << EOF
        # ðŸŽ‰ YOLOv8s å°ç£é»‘ç†Šæª¢æ¸¬ç³»çµ± $VERSION
        
        ## âœ¨ ä¸»è¦åŠŸèƒ½
        
        - ðŸ» é«˜ç²¾åº¦å°ç£é»‘ç†Šæª¢æ¸¬å’Œè­˜åˆ¥
        - ðŸš€ å®Œæ•´çš„ YOLOv8s è¨“ç·´ç®¡é“
        - ðŸ“Š è‡ªå‹•åŒ–è¶…åƒæ•¸å„ªåŒ–ï¼ˆOptunaï¼‰
        - ðŸ“ˆ è©³ç´°çš„è¨“ç·´ç›£æŽ§å’Œè¦–è¦ºåŒ–
        - ðŸ”§ å½ˆæ€§çš„é…ç½®ç®¡ç†ç³»çµ±
        
        ## ðŸ“¦ ç³»çµ±è¦æ±‚
        
        - Python 3.8+
        - PyTorch 1.8+
        - CUDA 11.0+ï¼ˆGPU è¨“ç·´ï¼‰
        
        ## ðŸš€ å¿«é€Ÿé–‹å§‹
        
        \`\`\`bash
        # å…‹éš†å°ˆæ¡ˆ
        git clone https://github.com/your-username/YOLOv8s_Pipeline.git
        cd YOLOv8s_Pipeline
        
        # å®‰è£ä¾è³´
        pip install -r requirements.txt
        
        # åŸ·è¡ŒåŸºæœ¬åŠŸèƒ½æ¸¬è©¦
        python test_basic_functionality.py
        
        # é–‹å§‹è¨“ç·´
        python main.py --mode train
        \`\`\`
        
        ## ðŸ“ æ›´æ–°å…§å®¹
        
        è©³ç´°æ›´æ–°å…§å®¹è«‹åƒè€ƒ [CHANGELOG.md](CHANGELOG.md)
        
        ## ðŸ¤ è²¢ç»
        
        æ„Ÿè¬æ‰€æœ‰è²¢ç»è€…çš„åŠªåŠ›ï¼è©³ç´°è²¢ç»æŒ‡å—è«‹åƒè€ƒ [CONTRIBUTING.md](CONTRIBUTING.md)
        
        ## ðŸ“„ æŽˆæ¬Š
        
        æœ¬å°ˆæ¡ˆæŽ¡ç”¨ MIT æŽˆæ¬Šæ¢æ¬¾ - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆ
        EOF
        
    - name: ðŸ“¦ å‰µå»º Release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ steps.release_notes.outputs.version }}
        release_name: YOLOv8s å°ç£é»‘ç†Šæª¢æ¸¬ç³»çµ± ${{ steps.release_notes.outputs.version }}
        body_path: release_notes.md
        draft: false
        prerelease: false
        
    - name: ðŸ“ˆ æ›´æ–°çµ±è¨ˆ
      run: |
        echo "ðŸŽ‰ Release ${{ steps.release_notes.outputs.version }} å‰µå»ºæˆåŠŸï¼"
        echo "ðŸ“Š å°ˆæ¡ˆçµ±è¨ˆï¼š"
        echo "- Python æª”æ¡ˆæ•¸é‡: $(find src/ -name "*.py" | wc -l)"
        echo "- ç¸½ç¨‹å¼ç¢¼è¡Œæ•¸: $(find src/ -name "*.py" -exec wc -l {} + | tail -1 | awk '{print $1}')"
        echo "- é…ç½®æª”æ¡ˆæ•¸é‡: $(find config/ -name "*.yaml" | wc -l)"
