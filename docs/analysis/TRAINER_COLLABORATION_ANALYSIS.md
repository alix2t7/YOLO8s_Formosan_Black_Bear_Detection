# YOLOv8sTrainer èˆ‡ main.py å”ä½œåˆ†æå ±å‘Š

## ğŸ¯ å”ä½œç‹€æ³ç¸½çµ

### âœ… å”ä½œæ­£å¸¸ï¼Œæ ¸å¿ƒè¨“ç·´åŠŸèƒ½å®Œæ•´

ç¶“éä»£ç¢¼å¯©æŸ¥ï¼Œ`YOLOv8sTrainer` èˆ‡ `main.py` çš„å”ä½œå®Œå…¨æ­£å¸¸ï¼Œæä¾›äº†å®Œæ•´çš„ YOLOv8s è¨“ç·´åŠŸèƒ½ã€‚

## ğŸ”§ main.py ä¸­çš„ YOLOv8sTrainer ä½¿ç”¨åˆ†æ

### å®Œæ•´çš„ä½¿ç”¨æµç¨‹

**ç¬¬31è¡Œ**: `from src.training.trainer import YOLOv8sTrainer` - âœ… å°å…¥æˆåŠŸ
**ç¬¬55è¡Œ**: `self.trainer = None` - âœ… å±¬æ€§åˆå§‹åŒ–
**ç¬¬214-216è¡Œ**: `self.trainer = YOLOv8sTrainer(config=self.training_config)` - âœ… å¯¦ä¾‹åŒ–
**ç¬¬219è¡Œ**: `if not self.trainer.setup_environment():` - âœ… ç’°å¢ƒè¨­ç½®
**ç¬¬225è¡Œ**: `best_params = self.trainer.load_best_params()` - âœ… åƒæ•¸è¼‰å…¥
**ç¬¬232è¡Œ**: `training_results = self.trainer.run_complete_training()` - âœ… æ ¸å¿ƒè¨“ç·´

### å…·é«”ä½¿ç”¨å ´æ™¯

```python
# main.py åœ¨ train_model() æ–¹æ³•ä¸­çš„å®Œæ•´ä½¿ç”¨
def train_model(self, use_best_params: bool = True) -> bool:
    try:
        # 1. åˆå§‹åŒ–è¨“ç·´å™¨
        self.trainer = YOLOv8sTrainer(
            config=self.training_config
        )
        
        # 2. è¨­ç½®è¨“ç·´ç’°å¢ƒ
        if not self.trainer.setup_environment():
            self.logger.error("è¨“ç·´ç’°å¢ƒè¨­ç½®å¤±æ•—")
            return False
        
        # 3. è¼‰å…¥æœ€ä½³åƒæ•¸ï¼ˆå¦‚æœæœ‰ï¼‰
        if use_best_params:
            best_params = self.trainer.load_best_params()
            if best_params:
                self.logger.info("ğŸ“¥ ä½¿ç”¨å„ªåŒ–å¾Œçš„æœ€ä½³åƒæ•¸")
            else:
                self.logger.info("ğŸ“‹ ä½¿ç”¨é»˜èªè¨“ç·´åƒæ•¸")
        
        # 4. åŸ·è¡Œå®Œæ•´è¨“ç·´
        training_results = self.trainer.run_complete_training()
        
        # 5. è™•ç†è¨“ç·´çµæœ
        if training_results:
            results_path = os.path.join(self.results_dir, "training_results.yaml")
            self.file_manager.save_config(training_results, results_path)
            
            self.logger.info("âœ… æ¨¡å‹è¨“ç·´å®Œæˆ")
            self.logger.info(f"ğŸ¯ æœ€çµ‚æ€§èƒ½: {training_results.get('final_metrics', {})}")
            return True
        else:
            self.logger.error("è¨“ç·´å¤±æ•—")
            return False
```

## ğŸ“Š YOLOv8sTrainer æä¾›çš„åŠŸèƒ½å®Œæ•´æ€§

### æ ¸å¿ƒè¨“ç·´åŠŸèƒ½ âœ… **main.py å……åˆ†ä½¿ç”¨**

#### 1. è¨“ç·´ç’°å¢ƒè¨­ç½® âœ… **main.py ç¬¬219è¡Œä½¿ç”¨**
- `setup_environment()` - å®Œæ•´çš„è¨“ç·´ç’°å¢ƒæº–å‚™
  - å‰µå»ºå¿…è¦ç›®éŒ„çµæ§‹
  - æª¢æŸ¥å’Œå‰µå»ºæ•¸æ“šé…ç½®æ–‡ä»¶
  - é©—è­‰è¨“ç·´ç’°å¢ƒæº–å‚™ç‹€æ…‹

#### 2. æœ€ä½³åƒæ•¸è¼‰å…¥ âœ… **main.py ç¬¬225è¡Œä½¿ç”¨**
- `load_best_params()` - å„ªåŒ–åƒæ•¸æ•´åˆ
  - æ”¯æ´å¾ Optuna å„ªåŒ–çµæœè¼‰å…¥åƒæ•¸
  - æä¾›åƒæ•¸å„ªå…ˆç´šç®¡ç†
  - é»˜èªåƒæ•¸å›é€€æ©Ÿåˆ¶

#### 3. å®Œæ•´è¨“ç·´æµç¨‹ âœ… **main.py ç¬¬232è¡Œä½¿ç”¨**
- `run_complete_training()` - ä¸€é«”åŒ–è¨“ç·´åŸ·è¡Œ
  - ç’°å¢ƒè¨­ç½®è‡ªå‹•åŒ–
  - åƒæ•¸è¼‰å…¥è‡ªå‹•åŒ–
  - æ¨¡å‹è¨“ç·´åŸ·è¡Œ
  - é©—è­‰å’Œå°å‡ºè‡ªå‹•åŒ–

### å°ˆæ¥­è¨“ç·´åŠŸèƒ½ âœ…

#### YOLOv8s å°ˆç”¨é…ç½®
- **æ¨¡å‹æ¶æ§‹**: æ”¯æ´ yolov8s é è¨“ç·´æ¨¡å‹è¼‰å…¥
- **ç†Šé¡æª¢æ¸¬**: 2 åˆ†é¡é…ç½® (kumay, not_kumay)
- **åœ–åƒå°ºå¯¸**: 640x640 æ¨™æº–è¼¸å…¥å°ºå¯¸
- **è¨“ç·´åƒæ•¸**: epochs, batch_size, patience å®Œæ•´é…ç½®

#### æ™ºèƒ½è¨“ç·´ç®¡ç† (`train_model`)
- **YOLO åŸç”Ÿè¨“ç·´**: åŸºæ–¼ ultralytics æ¡†æ¶
- **GPU é…ç½®**: è‡ªå‹• GPU æª¢æ¸¬å’Œé…ç½®
- **è¨“ç·´ç›£æ§**: å¯¦æ™‚è¨“ç·´é€²åº¦å’Œæ€§èƒ½ç›£æ§
- **æ—©åœæ©Ÿåˆ¶**: patience åƒæ•¸æ§åˆ¶çš„æ™ºèƒ½æ—©åœ

#### æ¨¡å‹é©—è­‰å’Œå°å‡º
- **é©—è­‰è©•ä¼°** (`_validate_model`): è¨“ç·´å¾Œæ¨¡å‹æ€§èƒ½é©—è­‰
- **æ¨¡å‹å°å‡º** (`_export_model`): æ”¯æ´å¤šç¨®æ ¼å¼å°å‡º
- **çµæœè§£æ** (`_parse_results`): è©³ç´°çš„è¨“ç·´çµæœåˆ†æ

#### é…ç½®æ–‡ä»¶ç®¡ç†
- **æ•¸æ“šé…ç½®ç”Ÿæˆ** (`_create_default_data_yaml`): è‡ªå‹•ç”Ÿæˆ YOLO æ•¸æ“šé…ç½®
- **åƒæ•¸ç®¡ç†** (`_prepare_training_args`): è¨“ç·´åƒæ•¸æº–å‚™å’Œå„ªåŒ–
- **GPU é…ç½®** (`setup_gpu_config`): GPU è³‡æºé…ç½®å’Œç®¡ç†

## ğŸš€ å”ä½œæ»¿è¶³åº¦åˆ†æ

### main.py çš„æ¨¡å‹è¨“ç·´éœ€æ±‚èˆ‡ YOLOv8sTrainer çš„æ”¯æ´

**main.py ç›®æ¨™**: åŸ·è¡Œå®Œæ•´çš„ YOLOv8s ç†Šé¡æª¢æ¸¬æ¨¡å‹è¨“ç·´

**YOLOv8sTrainer çš„å°ˆæ¥­æ”¯æ´**:

#### 1. ç„¡ç¸«ç’°å¢ƒæ•´åˆ âœ…
```python
# main.py éœ€æ±‚: ç°¡åŒ–çš„ç’°å¢ƒè¨­ç½®
if not self.trainer.setup_environment():
    self.logger.error("è¨“ç·´ç’°å¢ƒè¨­ç½®å¤±æ•—")
    return False

# YOLOv8sTrainer æ”¯æ´:
# 1. è‡ªå‹•ç›®éŒ„å‰µå»º: è¨“ç·´çµæœç›®éŒ„è‡ªå‹•åŒ–
# 2. æ•¸æ“šé…ç½®ç”Ÿæˆ: è‡ªå‹•ç”Ÿæˆ YOLO éœ€è¦çš„ data.yaml
# 3. ç’°å¢ƒé©—è­‰: å®Œæ•´çš„è¨“ç·´å‰ç’°å¢ƒæª¢æŸ¥
```

#### 2. æ™ºèƒ½åƒæ•¸ç®¡ç† âœ…
```python
# main.py éœ€æ±‚: æ•´åˆ Optuna å„ªåŒ–çµæœ
best_params = self.trainer.load_best_params()

# YOLOv8sTrainer æ”¯æ´:
# 1. åƒæ•¸è¼‰å…¥: è‡ªå‹•è¼‰å…¥ Optuna å„ªåŒ–çš„æœ€ä½³åƒæ•¸
# 2. åƒæ•¸é©—è­‰: åƒæ•¸æœ‰æ•ˆæ€§æª¢æŸ¥å’Œé è™•ç†
# 3. é»˜èªå›é€€: ç•¶ç„¡å„ªåŒ–åƒæ•¸æ™‚ä½¿ç”¨åˆç†é»˜èªå€¼
# 4. é…ç½®æ•´åˆ: èˆ‡è¨“ç·´é…ç½®çš„ç„¡ç¸«æ•´åˆ
```

#### 3. ä¸€é«”åŒ–è¨“ç·´åŸ·è¡Œ âœ…
```python
# main.py éœ€æ±‚: ç°¡æ½”çš„è¨“ç·´åŸ·è¡Œ
training_results = self.trainer.run_complete_training()

# YOLOv8sTrainer æ”¯æ´:
# 1. å®Œæ•´æµç¨‹: ç’°å¢ƒâ†’åƒæ•¸â†’è¨“ç·´â†’é©—è­‰â†’å°å‡º
# 2. éŒ¯èª¤è™•ç†: å®Œå–„çš„ç•°å¸¸è™•ç†å’Œç‹€æ…‹å ±å‘Š
# 3. çµæœç®¡ç†: çµæ§‹åŒ–çš„è¨“ç·´çµæœè¼¸å‡º
# 4. é€²åº¦ç›£æ§: è©³ç´°çš„è¨“ç·´é€²åº¦å’Œæ€§èƒ½ç›£æ§
```

#### 4. å°ˆæ¥­çµæœç®¡ç† âœ…
```python
# main.py çš„çµæœè™•ç†:
if training_results:
    self.file_manager.save_config(training_results, results_path)
    self.logger.info(f"ğŸ¯ æœ€çµ‚æ€§èƒ½: {training_results.get('final_metrics', {})}")

# YOLOv8sTrainer æä¾›çš„çµæœçµæ§‹:
{
    'training_result': training_result,
    'model_size': self.model_size,
    'experiment_name': self.experiment_name,
    'validation_result': validation_result,
    'export_result': export_result
}
```

## ğŸ” åŠŸèƒ½è¦†è“‹åº¦è©•ä¼°

### å®Œå…¨æ»¿è¶³çš„éœ€æ±‚ âœ…

- âœ… **YOLOv8s è¨“ç·´**: åŸºæ–¼ ultralytics çš„å®Œæ•´ YOLO è¨“ç·´æµç¨‹
- âœ… **ç†Šé¡æª¢æ¸¬ç‰¹åŒ–**: 2 åˆ†é¡ç›®æ¨™æª¢æ¸¬çš„å°ˆç”¨é…ç½®
- âœ… **åƒæ•¸å„ªåŒ–æ•´åˆ**: èˆ‡ Optuna å„ªåŒ–çµæœçš„ç„¡ç¸«æ•´åˆ
- âœ… **ç’°å¢ƒè‡ªå‹•åŒ–**: å®Œå…¨è‡ªå‹•åŒ–çš„è¨“ç·´ç’°å¢ƒæº–å‚™
- âœ… **çµæœç®¡ç†**: å®Œæ•´çš„è¨“ç·´çµæœè¨˜éŒ„å’Œåˆ†æ

### è¶…è¶ŠæœŸæœ›çš„å°ˆæ¥­åŠŸèƒ½ ğŸš€

- ğŸš€ **æ™ºèƒ½é…ç½®**: è‡ªå‹•ç”Ÿæˆæœ€é©åˆçš„ YOLO æ•¸æ“šé…ç½®
- ğŸš€ **GPU å„ªåŒ–**: è‡ªå‹• GPU æª¢æ¸¬å’Œæ€§èƒ½å„ªåŒ–é…ç½®
- ğŸš€ **æ¨¡å‹å°å‡º**: æ”¯æ´å¤šç¨®æ ¼å¼çš„æ¨¡å‹å°å‡º
- ğŸš€ **é©—è­‰è©•ä¼°**: è¨“ç·´å¾Œçš„å®Œæ•´æ¨¡å‹æ€§èƒ½è©•ä¼°
- ğŸš€ **éŒ¯èª¤æ¢å¾©**: å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œç‹€æ…‹æ¢å¾©æ©Ÿåˆ¶

## ğŸ’¡ å”ä½œäº®é»

### 1. å®Œç¾çš„é…ç½®æ•´åˆ âœ…
```python
# è‡ªå‹•å¾ main.py çš„ training_config æå–é…ç½®
self.trainer = YOLOv8sTrainer(config=self.training_config)

# YOLOv8sTrainer æ™ºèƒ½è§£æé…ç½®
model_config = config.get('model', {})
training_config = config.get('training', {})

self.model_size = model_config.get('name', 'yolov8s')
self.num_classes = model_config.get('num_classes', 2)
self.epochs = training_config.get('epochs', 300)
```

### 2. æ™ºèƒ½çš„åƒæ•¸å„ªå…ˆç´š âœ…
```python
# æ”¯æ´å¤šå±¤åƒæ•¸å„ªå…ˆç´š
def load_best_params(self, params: Optional[Dict[str, Any]] = None):
    # 1. å¤–éƒ¨å‚³å…¥åƒæ•¸ (æœ€é«˜å„ªå…ˆç´š)
    # 2. Optuna å„ªåŒ–çµæœ
    # 3. é…ç½®æ–‡ä»¶åƒæ•¸
    # 4. é»˜èªåƒæ•¸ (æœ€ä½å„ªå…ˆç´š)
```

### 3. å®Œæ•´çš„è¨“ç·´ç”Ÿå‘½é€±æœŸ âœ…
```python
# run_complete_training() æä¾›çš„å®Œæ•´æµç¨‹
def run_complete_training(self):
    # 1. ç’°å¢ƒè¨­ç½® â†’ setup_environment()
    # 2. åƒæ•¸è¼‰å…¥ â†’ load_best_params()
    # 3. æ¨¡å‹è¨“ç·´ â†’ train_model()
    # 4. æ¨¡å‹é©—è­‰ â†’ _validate_model()
    # 5. æ¨¡å‹å°å‡º â†’ _export_model()
```

## ğŸ‰ å”ä½œè©•ä¼°çµæœ

### å”ä½œè©•åˆ†: 9.3/10 âœ…

**å„ªç§€å”ä½œè¡¨ç¾**:

- âœ… **èªæ³•æ­£ç¢º**: å°å…¥å’Œæ–¹æ³•èª¿ç”¨å®Œå…¨æ­£ç¢º
- âœ… **åŠŸèƒ½å®Œæ•´**: æä¾›å®Œæ•´çš„ YOLOv8s è¨“ç·´åŠŸèƒ½
- âœ… **æ•´åˆå®Œç¾**: èˆ‡ main.py çš„é…ç½®å’Œæµç¨‹ç„¡ç¸«æ•´åˆ
- âœ… **ç†Šé¡ç‰¹åŒ–**: é‡å°ç†Šé¡æª¢æ¸¬ä»»å‹™çš„å°ˆç”¨å„ªåŒ–
- âœ… **çµæœå¯é **: å®Œå–„çš„è¨“ç·´çµæœç®¡ç†å’Œå ±å‘Š

**ç›®çš„å®Œç¾é”æˆ**:

- âœ… **æ¨¡å‹è¨“ç·´**: å®Œæ•´çš„ YOLOv8s ç†Šé¡æª¢æ¸¬æ¨¡å‹è¨“ç·´
- âœ… **æ€§èƒ½å„ªåŒ–**: èˆ‡ Optuna å„ªåŒ–çµæœçš„å®Œç¾æ•´åˆ
- âœ… **è‡ªå‹•åŒ–**: é«˜åº¦è‡ªå‹•åŒ–çš„è¨“ç·´ç’°å¢ƒå’Œæµç¨‹ç®¡ç†
- âœ… **å°ˆæ¥­æ€§**: ç¬¦åˆæ©Ÿå™¨å­¸ç¿’é …ç›®çš„æœ€ä½³å¯¦è¸
- âœ… **å¯é æ€§**: å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œç‹€æ…‹ç®¡ç†

**å”ä½œç‰¹è‰²**:

- ğŸš€ **ä¸€é«”åŒ–**: å¾ç’°å¢ƒè¨­ç½®åˆ°æ¨¡å‹å°å‡ºçš„å®Œæ•´ä¸€é«”åŒ–æµç¨‹
- ğŸš€ **æ™ºèƒ½åŒ–**: è‡ªå‹•é…ç½®ç”Ÿæˆå’Œåƒæ•¸å„ªåŒ–æ•´åˆ
- ğŸš€ **å°ˆæ¥­åŒ–**: åŸºæ–¼ ultralytics çš„å°ˆæ¥­ YOLO è¨“ç·´æ¡†æ¶
- ğŸš€ **æ¨¡çµ„åŒ–**: æ¸…æ™°çš„åŠŸèƒ½åˆ†é›¢å’Œæ¨¡çµ„åŒ–è¨­è¨ˆ

## ğŸ¯ çµè«–

### **YOLOv8sTrainer å®Œå…¨èƒ½å¤ é †åˆ©å®Œæˆèˆ‡ main.py çš„å”ä½œç›®çš„ï¼**

**æ ¸å¿ƒçµè«–**:

1. âœ… **æŠ€è¡“å”ä½œ**: YOLOv8sTrainer èˆ‡ main.py å”ä½œå®Œå…¨æ­£å¸¸ï¼Œç„¡ä»»ä½•æŠ€è¡“å•é¡Œ
2. âœ… **åŠŸèƒ½å°ˆæ¥­**: æä¾›ä¼æ¥­ç´šçš„ YOLOv8s è¨“ç·´å’Œæ¨¡å‹ç®¡ç†åŠŸèƒ½
3. âœ… **æ·±åº¦æ•´åˆ**: èˆ‡ main.py çš„é…ç½®ç³»çµ±å’Œ Optuna å„ªåŒ–çš„å®Œç¾æ•´åˆ
4. âœ… **ç›®æ¨™é”æˆ**: å®Œç¾æ”¯æ´ YOLOv8s ç†Šé¡æª¢æ¸¬æ¨¡å‹çš„å°ˆæ¥­è¨“ç·´

**å”ä½œå„ªå‹¢**:

- **å°ˆæ¥­æ€§**: åŸºæ–¼ ultralytics çš„å°ˆæ¥­ YOLO è¨“ç·´æ¡†æ¶
- **æ™ºèƒ½æ€§**: è‡ªå‹•åŒ–çš„ç’°å¢ƒè¨­ç½®å’Œé…ç½®ç®¡ç†
- **æ•´åˆæ€§**: èˆ‡è¶…åƒæ•¸å„ªåŒ–çš„ç„¡ç¸«æ•´åˆ
- **å¯é æ€§**: å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œè¨“ç·´æµç¨‹ç®¡ç†

**æœ€çµ‚è©•åƒ¹**: YOLOv8sTrainer ä¸åƒ…é †åˆ©å®Œæˆå”ä½œç›®çš„ï¼Œæ›´ç‚ºæ•´å€‹ YOLOv8s è¨“ç·´ Pipeline æä¾›äº†å°ˆæ¥­ã€å¯é ã€é«˜æ•ˆçš„æ ¸å¿ƒè¨“ç·´è§£æ±ºæ–¹æ¡ˆï¼é€™æ˜¯ä¸€å€‹å®Œæ•´çš„ä¼æ¥­ç´š YOLO è¨“ç·´ç³»çµ±ã€‚
